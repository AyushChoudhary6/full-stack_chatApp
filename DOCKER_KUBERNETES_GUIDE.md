#!/bin/bash

echo "üöÄ KUBERNETES + DOCKER DEPLOYMENT GUIDE"
echo "======================================="

echo ""
echo "üê≥ DOCKER DEPLOYMENT (Development/Testing):"
echo "============================================"
echo "This is automatically triggered on 'develop' branch pushes"
echo "Manual trigger available for 'main' branch"
echo ""
echo "‚úÖ Deploys using Docker Compose"
echo "‚úÖ Uses GitLab Container Registry images"
echo "‚úÖ Accessible at:"
echo "   - Frontend: http://localhost:3000"
echo "   - Backend: http://localhost:5000"
echo "   - Database: localhost:5432"

echo ""
echo "‚ò∏Ô∏è  KUBERNETES DEPLOYMENT (Production):"
echo "======================================="
echo "This is automatically triggered on 'main' branch pushes"
echo "Manual trigger available for 'develop' branch"
echo ""
echo "‚úÖ Deploys to Kubernetes cluster"
echo "‚úÖ Uses GitLab Container Registry images"
echo "‚úÖ Production-grade with:"
echo "   - Health checks"
echo "   - Resource limits"
echo "   - Persistent storage"
echo "   - Service discovery"

echo ""
echo "üîß SETUP REQUIREMENTS:"
echo "====================="
echo ""
echo "1. GitLab Variables (Add these to GitLab CI/CD ‚Üí Variables):"
echo "   JWT_SECRET: b7f3795f5cd50589b62ab5794272a413"
echo "   POSTGRES_PASSWORD: 8gaq834qizIYaG3c"
echo "   DATABASE_URL: postgresql://chatapp_user:8gaq834qizIYaG3c@postgres:5432/chatapp"
echo ""
echo "2. Local Kubernetes Cluster:"
echo "   - Kind cluster (recommended): https://kind.sigs.k8s.io/"
echo "   - Docker Desktop Kubernetes"
echo "   - Minikube"
echo "   - K3s"

echo ""
echo "üèÉ‚Äç‚ôÇÔ∏è QUICK START:"
echo "==============="
echo ""
echo "For Docker Deployment:"
echo "  1. Push to 'develop' branch (auto-deploys)"
echo "  2. Or manually trigger 'deploy_docker' job"
echo ""
echo "For Kubernetes Deployment:"
echo "  1. Ensure local K8s cluster is running"
echo "  2. Push to 'main' branch (auto-deploys to K8s)"
echo "  3. Access via port-forwarding:"
echo "     kubectl port-forward service/frontend-service 3000:80 -n chatapp"
echo "     kubectl port-forward service/backend-service 5000:5000 -n chatapp"

echo ""
echo "üìã PIPELINE STAGES:"
echo "=================="
echo "1. üß™ TEST - Backend tests + Frontend build"
echo "2. üèóÔ∏è  BUILD - Docker images ‚Üí GitLab Registry"
echo "3. üê≥ DEPLOY-DOCKER - Docker Compose deployment"
echo "4. ‚ò∏Ô∏è  DEPLOY-K8S - Kubernetes deployment"

echo ""
echo "üéØ ACCESS METHODS:"
echo "=================="
echo ""
echo "Docker Deployment:"
echo "  ‚úÖ Direct localhost access"
echo "  ‚úÖ No additional setup needed"
echo ""
echo "Kubernetes Deployment:"
echo "  ‚úÖ Production-grade"
echo "  ‚úÖ Scalable and resilient"
echo "  ‚úÖ Access via kubectl port-forward"
echo "  ‚úÖ Or setup Ingress for direct access"

echo ""
echo "üîó USEFUL COMMANDS:"
echo "=================="
echo ""
echo "# Check Kubernetes deployment"
echo "kubectl get all -n chatapp"
echo ""
echo "# View logs"
echo "kubectl logs -l app=backend -n chatapp"
echo "kubectl logs -l app=frontend -n chatapp"
echo ""
echo "# Access services"
echo "kubectl port-forward service/frontend-service 3000:80 -n chatapp &"
echo "kubectl port-forward service/backend-service 5000:5000 -n chatapp &"
echo ""
echo "# Stop port-forwards"
echo "pkill -f 'kubectl port-forward'"

echo ""
echo "üéâ Your pipeline now supports both Docker and Kubernetes deployments!"
